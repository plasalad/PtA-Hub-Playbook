<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PtA Migration Playbook - Enhanced v2.4</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    *{font-family:'Inter',-apple-system,sans-serif;box-sizing:border-box}
    body{background:#f8fafc;margin:0}
    .sidebar{width:64px;background:linear-gradient(180deg,#1e3a8a,#1e40af)}
    .sidebar-item{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:rgba(255,255,255,.6);transition:all .15s}
    .sidebar-item:hover{background:rgba(255,255,255,.1);color:#fff}
    .sidebar-item.active{background:rgba(255,255,255,.2);color:#fff}
    .card{background:#fff;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.05);padding:20px}
    .btn{padding:8px 16px;border-radius:8px;font-weight:500;font-size:14px;cursor:pointer;border:none;transition:all .15s}
    .btn-primary{background:#2563eb;color:#fff}
    .btn-primary:hover{background:#1d4ed8}
    .btn-secondary{background:#f1f5f9;color:#475569}
    .btn-success{background:#22c55e;color:#fff}
    .btn-sm{padding:6px 12px;font-size:13px}
    .input{width:100%;padding:10px 12px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px}
    .input:focus{outline:none;border-color:#2563eb}
    .badge{padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600}
    .badge-blue{background:#dbeafe;color:#1e40af}
    .badge-green{background:#dcfce7;color:#166534}
    .badge-amber{background:#fef3c7;color:#92400e}
    .badge-red{background:#fee2e2;color:#991b1b}
    .badge-purple{background:#f3e8ff;color:#7c3aed}
    .badge-slate{background:#f1f5f9;color:#475569}
    .value-pill{background:#eff6ff;color:#1e40af;padding:4px 10px;border-radius:6px;font-family:monospace;font-size:13px}
    .tab{padding:8px 16px;cursor:pointer;border-bottom:2px solid transparent;font-weight:500;color:#64748b}
    .tab.active{border-color:#2563eb;color:#2563eb}
    .fade-in{animation:fadeIn .2s ease-out}
    .label{display:block;font-size:12px;color:#64748b;margin-bottom:4px;font-weight:500}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    
    /* Tooltip */
    .tooltip-container{position:relative;display:inline-flex;align-items:center}
    .tooltip-trigger{cursor:help;color:#94a3b8;margin-left:4px;transition:color .15s}
    .tooltip-trigger:hover{color:#2563eb}
    .tooltip-content{position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);background:#1e293b;color:#fff;padding:8px 12px;border-radius:8px;font-size:12px;line-height:1.5;white-space:normal;width:240px;z-index:1000;opacity:0;visibility:hidden;transition:all .15s;box-shadow:0 4px 12px rgba(0,0,0,.15)}
    .tooltip-content::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:#1e293b}
    .tooltip-container:hover .tooltip-content{opacity:1;visibility:visible}
    
    /* Global Search */
    .search-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:9999;display:flex;justify-content:center;padding-top:100px}
    .search-modal{background:#fff;border-radius:16px;width:600px;max-height:70vh;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.3)}
    .search-result{padding:12px 16px;cursor:pointer;border-bottom:1px solid #f1f5f9;transition:background .1s}
    .search-result:hover{background:#f8fafc}
    .search-highlight{background:#fef08a;padding:0 2px;border-radius:2px}
    
    /* Checklist */
    .checklist-item{display:flex;align-items:flex-start;padding:12px;border-radius:8px;margin-bottom:8px;transition:all .15s;background:#fff;border:1px solid #e2e8f0}
    .checklist-item:hover{border-color:#2563eb}
    .checklist-item.completed{background:#f0fdf4;border-color:#22c55e}
    .checklist-item.skipped{background:#f1f5f9;opacity:.6}
    .checklist-checkbox{width:20px;height:20px;border-radius:4px;border:2px solid #d1d5db;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s}
    .checklist-checkbox.checked{background:#22c55e;border-color:#22c55e;color:#fff}
    .checklist-checkbox.na{background:#94a3b8;border-color:#94a3b8;color:#fff}
    
    /* Flowchart */
    .flowchart-node{padding:12px 20px;border-radius:8px;text-align:center;font-size:13px;cursor:pointer;transition:all .15s;min-width:120px}
    .flowchart-node:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.1)}
    .flowchart-node.start{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;border-radius:24px}
    .flowchart-node.end{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;border-radius:24px}
    .flowchart-node.decision{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff}
    .flowchart-node.process{background:#fff;border:2px solid #2563eb;color:#1e293b}
    .flowchart-node.active{background:#2563eb;color:#fff;border-color:#2563eb}
    
    /* Rating */
    .rating-star{cursor:pointer;color:#d1d5db;transition:color .1s}
    .rating-star:hover,.rating-star.active{color:#fbbf24}
    
    /* Compliance */
    .audit-badge{display:inline-flex;align-items:center;gap:4px;padding:4px 8px;border-radius:4px;font-size:11px;font-weight:600}
    .audit-badge.compliant{background:#dcfce7;color:#166534}
    .audit-badge.warning{background:#fef3c7;color:#92400e}
    .audit-badge.violation{background:#fee2e2;color:#991b1b}
    .compliance-meter{height:8px;background:#e2e8f0;border-radius:4px;overflow:hidden}
    .compliance-meter-fill{height:100%;border-radius:4px;transition:width .3s}
    
    /* Version History */
    .version-timeline{position:relative;padding-left:24px}
    .version-timeline::before{content:'';position:absolute;left:8px;top:0;bottom:0;width:2px;background:#e2e8f0}
    .version-item{position:relative;padding:12px 0;border-bottom:1px solid #f1f5f9}
    .version-item::before{content:'';position:absolute;left:-20px;top:16px;width:12px;height:12px;border-radius:50%;background:#2563eb;border:2px solid #fff}
    .version-item.minor::before{background:#94a3b8}
    
    /* Chat */
    .advisor-panel{width:320px;background:#fff;border-left:1px solid #e2e8f0;display:flex;flex-direction:column}
    .chat-bubble{max-width:90%;padding:10px 14px;border-radius:12px;font-size:14px;line-height:1.5}
    .chat-user{background:#2563eb;color:#fff;border-bottom-right-radius:4px;margin-left:auto}
    .chat-ai{background:#f1f5f9;color:#1e293b;border-bottom-left-radius:4px}
    @media(max-width:1024px){.advisor-panel{display:none}}
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState, useEffect, useRef, useCallback, useMemo} = React;

// Icon Component
const Icon = ({name, size=20, className=""}) => {
  const ref = useRef(null);
  useEffect(() => {
    if (ref.current && lucide.icons[name]) {
      ref.current.innerHTML = "";
      const svg = lucide.createElement(lucide.icons[name]);
      svg.setAttribute("width", size);
      svg.setAttribute("height", size);
      ref.current.appendChild(svg);
    }
  }, [name, size]);
  return <span ref={ref} className={`inline-flex items-center justify-center ${className}`}/>;
};

// FEATURE 2: Contextual Help Tooltip
const Tooltip = ({content, children}) => (
  <span className="tooltip-container">
    {children}
    <span className="tooltip-trigger"><Icon name="HelpCircle" size={14} /></span>
    <span className="tooltip-content">{content}</span>
  </span>
);

// FEATURE 4: Global Search
const GlobalSearch = ({isOpen, onClose, data}) => {
  const [query, setQuery] = useState("");
  const inputRef = useRef(null);
  
  useEffect(() => { if (isOpen && inputRef.current) inputRef.current.focus(); }, [isOpen]);
  
  const results = useMemo(() => {
    if (!query.trim()) return [];
    const q = query.toLowerCase();
    return data.filter(item => 
      item.title?.toLowerCase().includes(q) || 
      item.keywords?.some(k => k.toLowerCase().includes(q))
    ).slice(0, 8);
  }, [query, data]);
  
  if (!isOpen) return null;
  
  return (
    <div className="search-overlay" onClick={onClose}>
      <div className="search-modal" onClick={e => e.stopPropagation()}>
        <div className="p-4 border-b flex items-center gap-3">
          <Icon name="Search" size={20} className="text-slate-400" />
          <input ref={inputRef} type="text" className="flex-1 text-lg outline-none" placeholder="Search workflows, guides, settings..." value={query} onChange={e => setQuery(e.target.value)} />
          <kbd className="text-xs bg-slate-100 px-2 py-1 rounded">ESC</kbd>
        </div>
        <div className="max-h-96 overflow-auto">
          {results.length === 0 && query && <div className="p-8 text-center text-slate-400"><Icon name="SearchX" size={40} className="mx-auto mb-3 opacity-50" /><p>No results for "{query}"</p></div>}
          {results.map((r, i) => (
            <div key={i} className="search-result" onClick={() => { r.onSelect?.(); onClose(); }}>
              <div className="flex items-center gap-2">
                <span className="font-semibold">{r.title}</span>
                <span className="text-xs px-2 py-0.5 rounded bg-blue-100 text-blue-700">{r.type}</span>
              </div>
              {r.preview && <p className="text-sm text-slate-500 mt-1">{r.preview}</p>}
            </div>
          ))}
          {!query && <div className="p-6"><p className="text-sm text-slate-500 mb-3">Quick searches:</p><div className="flex flex-wrap gap-2">{["Create Project", "Budget", "Settlement", "TECO", "Tax Review"].map(t => <button key={t} onClick={() => setQuery(t)} className="px-3 py-1 bg-slate-100 rounded-full text-sm hover:bg-slate-200">{t}</button>)}</div></div>}
        </div>
      </div>
    </div>
  );
};

// FEATURE 1: Smart Checklist
const SmartChecklist = ({items, projectData, onComplete}) => {
  const [checks, setChecks] = useState({});
  
  const evaluatedItems = useMemo(() => items.map(item => {
    let skip = false, skipReason = "";
    if (item.condition === "emit_only" && projectData?.budgetClass !== "03") { skip = true; skipReason = "Only for EMIT (03)"; }
    if (item.condition === "capital_only" && projectData?.projectCategory !== "Capital") { skip = true; skipReason = "Only for Capital projects"; }
    if (item.condition === "obo_only" && projectData?.businessArea !== "6602") { skip = true; skipReason = "Only for OBO"; }
    if (item.condition === "budget_3m" && (projectData?.netBudgetAUD || 0) <= 3000000) { skip = true; skipReason = `Net ${((projectData?.netBudgetAUD||0)/1e6).toFixed(1)}M ‚â§ $3M`; }
    if (item.condition === "budget_5m" && (projectData?.netBudgetAUD || 0) <= 5000000) { skip = true; skipReason = `Net ${((projectData?.netBudgetAUD||0)/1e6).toFixed(1)}M ‚â§ $5M`; }
    return {...item, skip, skipReason};
  }), [items, projectData]);
  
  const progress = useMemo(() => {
    const active = evaluatedItems.filter(i => !i.skip);
    const done = active.filter(i => checks[i.id]);
    return active.length > 0 ? Math.round((done.length / active.length) * 100) : 0;
  }, [evaluatedItems, checks]);
  
  return (
    <div>
      <div className="flex justify-between items-center mb-4">
        <h4 className="font-semibold flex items-center gap-2"><Icon name="CheckSquare" size={18} className="text-green-600" /> Smart Checklist</h4>
        <div className="flex items-center gap-3">
          <span className="text-sm text-slate-500">{progress}%</span>
          <div className="w-32 h-2 bg-slate-200 rounded-full overflow-hidden"><div className="h-full bg-green-500 rounded-full transition-all" style={{width:`${progress}%`}} /></div>
        </div>
      </div>
      {evaluatedItems.map(item => (
        <div key={item.id} className={`checklist-item ${checks[item.id] ? 'completed' : ''} ${item.skip ? 'skipped' : ''}`}>
          <div className={`checklist-checkbox ${checks[item.id] ? 'checked' : ''} ${item.skip ? 'na' : ''}`} onClick={() => !item.skip && setChecks({...checks, [item.id]: !checks[item.id]})}>
            {checks[item.id] && <Icon name="Check" size={14} />}
            {item.skip && <Icon name="Minus" size={14} />}
          </div>
          <div className="ml-3 flex-1">
            <div className="flex items-center gap-2">
              <span className={`font-medium ${item.skip ? 'line-through text-slate-400' : ''}`}>{item.title}</span>
              {item.skip && <span className="text-xs bg-slate-200 text-slate-600 px-2 py-0.5 rounded">Auto-skipped</span>}
              {item.critical && !item.skip && <span className="badge badge-red">Critical</span>}
            </div>
            <p className="text-sm text-slate-500 mt-1">{item.skip ? item.skipReason : item.description}</p>
            {item.approver && !item.skip && <p className="text-xs text-blue-600 mt-1">Approver: {item.approver}</p>}
          </div>
        </div>
      ))}
    </div>
  );
};

// FEATURE 7: Feedback System
const FeedbackSystem = ({onSubmit}) => {
  const [show, setShow] = useState(false);
  const [rating, setRating] = useState(0);
  const [comment, setComment] = useState("");
  const [done, setDone] = useState(false);
  
  const submit = () => { onSubmit?.({rating, comment, at: new Date().toISOString()}); setDone(true); setTimeout(() => setShow(false), 2000); };
  
  return (
    <div className="mt-4 pt-4 border-t">
      {!show ? <button onClick={() => setShow(true)} className="text-sm text-blue-600 hover:underline flex items-center gap-1"><Icon name="MessageSquarePlus" size={14} /> Rate this guide</button> : (
        <div className="space-y-3 fade-in">
          <div className="flex items-center gap-2">
            <span className="text-sm">How helpful?</span>
            <div className="flex gap-1">{[1,2,3,4,5].map(s => <span key={s} className={`rating-star ${s <= rating ? 'active' : ''}`} onClick={() => setRating(s)}><Icon name="Star" size={20} /></span>)}</div>
          </div>
          <textarea className="input text-sm" placeholder="Suggestions?" value={comment} onChange={e => setComment(e.target.value)} rows={2} />
          <div className="flex gap-2">
            <button onClick={submit} className="btn btn-primary btn-sm" disabled={done}>{done ? '‚úì Thanks!' : 'Submit'}</button>
            <button onClick={() => setShow(false)} className="btn btn-secondary btn-sm">Cancel</button>
          </div>
        </div>
      )}
    </div>
  );
};

// FEATURE 8: Compliance & Audit
const ComplianceAudit = ({score, rules, auditLog}) => (
  <div className="card">
    <div className="flex justify-between items-center mb-4">
      <h3 className="font-semibold flex items-center gap-2"><Icon name="Shield" size={18} className="text-blue-600" /> Compliance</h3>
      <div className={`audit-badge ${score >= 90 ? 'compliant' : score >= 70 ? 'warning' : 'violation'}`}>
        <Icon name={score >= 90 ? 'ShieldCheck' : 'ShieldAlert'} size={14} /> {score}%
      </div>
    </div>
    <div className="compliance-meter mb-4"><div className="compliance-meter-fill" style={{width:`${score}%`, background: score >= 90 ? '#22c55e' : score >= 70 ? '#f59e0b' : '#ef4444'}} /></div>
    <div className="space-y-2 mb-4">
      {rules?.map((r, i) => (
        <div key={i} className="flex items-center justify-between p-2 bg-slate-50 rounded">
          <div className="flex items-center gap-2"><Icon name={r.passed ? 'CheckCircle' : 'XCircle'} size={16} className={r.passed ? 'text-green-600' : 'text-red-600'} /><span className="text-sm">{r.name}</span></div>
          <span className={`badge ${r.passed ? 'badge-green' : 'badge-red'}`}>{r.passed ? 'OK' : 'Fail'}</span>
        </div>
      ))}
    </div>
    <div className="border-t pt-4">
      <h4 className="font-medium text-sm mb-2 flex items-center gap-2"><Icon name="FileText" size={14} /> Audit Trail</h4>
      <div className="space-y-1 max-h-40 overflow-auto text-xs">
        {auditLog?.map((e, i) => <div key={i} className="flex gap-2"><span className="text-slate-400">{new Date(e.ts).toLocaleString()}</span><span className={e.type === 'approval' ? 'text-green-600' : 'text-slate-600'}>{e.action}</span><span className="text-slate-500">by {e.user}</span></div>)}
      </div>
    </div>
  </div>
);

// FEATURE 9: Interactive Flowchart
const InteractiveFlowchart = ({nodes, activeStep, onNodeClick}) => (
  <div className="bg-slate-50 rounded-xl p-6">
    <h4 className="font-semibold mb-4 flex items-center gap-2"><Icon name="GitBranch" size={18} className="text-purple-600" /> Process Flow</h4>
    <div className="flex flex-wrap items-center gap-4 justify-center">
      {nodes?.map((node, i) => (
        <React.Fragment key={node.id}>
          <div className={`flowchart-node ${node.type} ${activeStep === node.id ? 'active' : ''}`} onClick={() => onNodeClick?.(node)}>
            <div className="flex items-center gap-2 justify-center">
              {node.icon && <Icon name={node.icon} size={16} />}
              <span>{node.label}</span>
            </div>
          </div>
          {i < nodes.length - 1 && <Icon name="ArrowRight" size={20} className="text-slate-400" />}
        </React.Fragment>
      ))}
    </div>
  </div>
);

// FEATURE 3: Version History
const VersionHistory = ({versions, current, onRestore}) => (
  <div className="card">
    <div className="flex justify-between items-center mb-4">
      <h3 className="font-semibold flex items-center gap-2"><Icon name="History" size={18} className="text-blue-600" /> Version History</h3>
      <span className="badge badge-blue">v{current}</span>
    </div>
    <div className="version-timeline">
      {versions?.map((v, i) => (
        <div key={i} className={`version-item ${v.type === 'minor' ? 'minor' : ''}`}>
          <div className="flex justify-between items-start">
            <div>
              <div className="flex items-center gap-2"><span className="font-semibold">v{v.version}</span><span className={`badge ${v.type === 'major' ? 'badge-blue' : 'badge-slate'}`}>{v.type}</span></div>
              <p className="text-sm text-slate-600 mt-1">{v.description}</p>
              <p className="text-xs text-slate-400 mt-1">{v.author} ‚Ä¢ {v.date}</p>
            </div>
            {i > 0 && <button onClick={() => onRestore?.(v)} className="btn btn-secondary btn-sm"><Icon name="RotateCcw" size={14} className="mr-1" /> Restore</button>}
          </div>
        </div>
      ))}
    </div>
  </div>
);

// FEATURE 5: Export Manager
const ExportManager = ({data, project, onExport}) => {
  const [format, setFormat] = useState('pdf');
  const [exporting, setExporting] = useState(false);
  
  const doExport = async () => {
    setExporting(true);
    try {
      if (format === 'pdf') {
        const {jsPDF} = window.jspdf;
        const doc = new jsPDF();
        doc.setFontSize(18); doc.text('SAP Playbook Export', 20, 20);
        doc.setFontSize(12); doc.text(`Generated: ${new Date().toLocaleString()}`, 20, 30);
        if (project) {
          doc.text(`Project: ${project.projectNumber || 'N/A'}`, 20, 45);
          doc.text(`Budget: ${(project.grossBudget||0).toLocaleString()} AUD`, 20, 55);
          doc.text(`Net: ${(project.netBudgetAUD||0).toLocaleString()} AUD`, 20, 65);
          doc.text(`Approval: ${project.requiredLevel?.description || 'N/A'}`, 20, 75);
        }
        doc.save(`playbook-${new Date().toISOString().split('T')[0]}.pdf`);
      } else if (format === 'csv') {
        let csv = 'SAP Playbook Export\n\nProject,' + (project?.projectNumber || 'N/A') + '\nBudget,' + (project?.grossBudget || 0) + '\nNet AUD,' + (project?.netBudgetAUD || 0) + '\nApproval,' + (project?.requiredLevel?.description || 'N/A');
        const blob = new Blob([csv], {type: 'text/csv'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `playbook-${new Date().toISOString().split('T')[0]}.csv`; a.click();
      } else {
        const blob = new Blob([JSON.stringify({project, data, exportedAt: new Date().toISOString()}, null, 2)], {type: 'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `playbook-${new Date().toISOString().split('T')[0]}.json`; a.click();
      }
      onExport?.({format});
    } catch (e) { alert('Export failed: ' + e.message); }
    setExporting(false);
  };
  
  return (
    <div className="card">
      <h3 className="font-semibold mb-4 flex items-center gap-2"><Icon name="Download" size={18} className="text-blue-600" /> Export</h3>
      <div className="flex gap-2 mb-4">
        {[{id:'pdf',icon:'FileText',label:'PDF'},{id:'csv',icon:'Table',label:'CSV'},{id:'json',icon:'Code',label:'JSON'}].map(f => (
          <button key={f.id} onClick={() => setFormat(f.id)} className={`flex-1 p-3 rounded-lg border-2 ${format === f.id ? 'border-blue-500 bg-blue-50' : 'border-slate-200'}`}>
            <Icon name={f.icon} size={20} className={`mx-auto mb-1 ${format === f.id ? 'text-blue-600' : 'text-slate-400'}`} /><span className="text-sm">{f.label}</span>
          </button>
        ))}
      </div>
      <button onClick={doExport} disabled={exporting} className="btn btn-primary w-full">
        {exporting ? <><Icon name="Loader" size={16} className="mr-2 animate-spin" /> Exporting...</> : <><Icon name="Download" size={16} className="mr-2" /> Export {format.toUpperCase()}</>}
      </button>
    </div>
  );
};

// FEATURE 6: AI Insights
const AIInsights = ({project, onAction}) => {
  const [analyzing, setAnalyzing] = useState(false);
  const [insights, setInsights] = useState([]);
  const [risk, setRisk] = useState(null);
  
  const analyze = () => {
    setAnalyzing(true);
    setTimeout(() => {
      const newInsights = [], risks = [];
      if (project?.grossBudget > 5e6) { newInsights.push({type:'warning',title:'High-Value Project',desc:'Consider engaging Tax Team early for >$5M'}); risks.push({level:'medium',desc:'Tax review threshold'}); }
      if (project?.grossBudget > 20e6) { newInsights.push({type:'critical',title:'Executive Approval',desc:'Projects >$20M need Level 5+'}); risks.push({level:'high',desc:'Executive approval chain'}); }
      if (project?.budgetClass === '03') { newInsights.push({type:'info',title:'EMIT Classification',desc:'Fund.IT ruling required first'}); }
      if (project?.budgetClass === 'XF') { newInsights.push({type:'critical',title:'Decommissioning',desc:'Settlement rule to 490000030 BEFORE TECO'}); risks.push({level:'high',desc:'Settlement critical path'}); }
      if ((project?.emShare || 100) < 100) { newInsights.push({type:'info',title:'Joint Venture',desc:`EM ${project.emShare}%. JV approval if >$5M`}); }
      setInsights(newInsights);
      setRisk({overall: risks.some(r => r.level === 'high') ? 'high' : risks.some(r => r.level === 'medium') ? 'medium' : 'low', items: risks});
      setAnalyzing(false);
    }, 1200);
  };
  
  return (
    <div className="card">
      <div className="flex justify-between items-center mb-4">
        <h3 className="font-semibold flex items-center gap-2"><Icon name="Sparkles" size={18} className="text-purple-600" /> AI Insights</h3>
        <button onClick={analyze} disabled={analyzing} className="btn btn-secondary btn-sm">{analyzing ? <><Icon name="Loader" size={14} className="mr-1 animate-spin" /> Analyzing...</> : <><Icon name="Zap" size={14} className="mr-1" /> Analyze</>}</button>
      </div>
      {risk && (
        <div className={`p-3 rounded-lg mb-4 ${risk.overall === 'high' ? 'bg-red-50 border border-red-200' : risk.overall === 'medium' ? 'bg-amber-50 border border-amber-200' : 'bg-green-50 border border-green-200'}`}>
          <div className="flex items-center gap-2 mb-1"><Icon name={risk.overall === 'high' ? 'AlertTriangle' : risk.overall === 'medium' ? 'AlertCircle' : 'CheckCircle'} size={16} className={risk.overall === 'high' ? 'text-red-600' : risk.overall === 'medium' ? 'text-amber-600' : 'text-green-600'} /><span className="font-medium capitalize">{risk.overall} Risk</span></div>
          {risk.items.length > 0 && <ul className="text-sm space-y-1">{risk.items.map((r, i) => <li key={i} className="flex items-center gap-2"><span className={`w-2 h-2 rounded-full ${r.level === 'high' ? 'bg-red-500' : 'bg-amber-500'}`} />{r.desc}</li>)}</ul>}
        </div>
      )}
      <div className="space-y-3">
        {insights.map((s, i) => (
          <div key={i} className={`p-3 rounded-lg border ${s.type === 'critical' ? 'bg-red-50 border-red-200' : s.type === 'warning' ? 'bg-amber-50 border-amber-200' : 'bg-blue-50 border-blue-200'}`}>
            <div className="flex items-start justify-between">
              <div className="flex items-start gap-2">
                <Icon name={s.type === 'critical' ? 'AlertTriangle' : s.type === 'warning' ? 'AlertCircle' : 'Info'} size={16} className={s.type === 'critical' ? 'text-red-600' : s.type === 'warning' ? 'text-amber-600' : 'text-blue-600'} />
                <div><p className="font-medium text-sm">{s.title}</p><p className="text-xs text-slate-600 mt-1">{s.desc}</p></div>
              </div>
            </div>
          </div>
        ))}
        {insights.length === 0 && !analyzing && <div className="text-center py-6 text-slate-400"><Icon name="Sparkles" size={32} className="mx-auto mb-2 opacity-50" /><p className="text-sm">Click Analyze for AI insights</p></div>}
      </div>
    </div>
  );
};

// Configuration
const CONFIG = {
  exchangeRate: {AUD_USD: 1.59, nextUpdate: "2025-07-01"},
  companyCodes: [{code:"1230",name:"Main Entity (EMOP)",ba:"6601"},{code:"0495",name:"Secondary",ba:"6601"},{code:"4310",name:"OBO",ba:"6602"}],
  budgetClasses: [{code:"01",name:"Drilling",cat:"Capital"},{code:"02",name:"Facilities",cat:"Capital"},{code:"03",name:"EMIT",cat:"Capital",ruling:true},{code:"XF",name:"Decommissioning",cat:"Decommissioning"}],
  stages: [{code:"PRE",name:"Pre-development"},{code:"APR",name:"Appraisal"},{code:"DEV",name:"Development"},{code:"PRD",name:"Production"}],
  jvCodes: {"1230":[{code:"AU001",name:"JV Partner A",em:50},{code:"AU002",name:"JV Partner B",em:20},{code:"AU003",name:"EM Sole Risk",em:100}],"0495":[{code:"AU004",name:"EM Sole Risk",em:100}],"4310":[{code:"AU005",name:"OBO EM Sole Risk",em:100}]}
};

const VERSIONS = [
  {version:"2.4.0",type:"major",description:"Added Smart Checklists, AI Insights, Flowcharts",author:"System",date:"2025-01-15"},
  {version:"2.3.0",type:"major",description:"Compliance tracking & audit trail",author:"System",date:"2025-01-05"},
  {version:"2.2.0",type:"minor",description:"Export enhancements",author:"Admin",date:"2024-12-20"},
  {version:"2.1.0",type:"minor",description:"UI improvements",author:"Admin",date:"2024-12-15"}
];

const FLOW_NODES = [
  {id:'start',type:'start',label:'Start',icon:'Play'},
  {id:'prereq',type:'process',label:'Prerequisites',icon:'ClipboardList'},
  {id:'fccr',type:'decision',label:'FCCR',icon:'FileCheck'},
  {id:'tax',type:'decision',label:'Tax?',icon:'Calculator'},
  {id:'sap',type:'process',label:'SAP Entry',icon:'Database'},
  {id:'budget',type:'process',label:'Budget',icon:'DollarSign'},
  {id:'end',type:'end',label:'Done',icon:'CheckCircle'}
];

const CHECKLIST_ITEMS = [
  {id:'fundit',title:'Fund.IT Ruling',description:'CAPEX/OPEX ruling for EMIT',approver:'Fund.IT',critical:true,condition:'emit_only'},
  {id:'fccr',title:'FCCR Approval',description:'Required for ALL projects',approver:'FCCR',critical:true},
  {id:'dataflex',title:'Dataflex TC Code',description:'Required for Capital projects',approver:'Financial Reporting',condition:'capital_only'},
  {id:'doag',title:'DOAG Approval',description:'Required for all projects',approver:'DOAG'},
  {id:'tax',title:'Tax Review',description:'Required when net > $3M AUD',approver:'Tax Team',critical:true,condition:'budget_3m'},
  {id:'jv',title:'JV Approval',description:'Required when net > $5M AUD',approver:'JV Partners',critical:true,condition:'budget_5m'},
  {id:'obo',title:'OBO Approval',description:'For OBO projects',approver:'JV/OBO',critical:true,condition:'obo_only'},
  {id:'level',title:'Level Approval',description:'Based on net USD amount',approver:'Per threshold',critical:true}
];

const SEARCH_DATA = [
  {title:"Create Project",type:"Workflow",keywords:["project","create","CJ20N"],preview:"Step-by-step project creation"},
  {title:"Budget Entry",type:"Workflow",keywords:["budget","ZJ40"],preview:"Enter budget at WBS L1"},
  {title:"Tax Review",type:"Guide",keywords:["tax","$3M"],preview:"Required when net > $3M"},
  {title:"Settlement Rules",type:"Guide",keywords:["settlement","KO88","KO02"],preview:"Configure settlement"},
  {title:"TECO Status",type:"Guide",keywords:["TECO","close"],preview:"Technically complete"},
  {title:"Decommissioning",type:"Guide",keywords:["XF","490000030"],preview:"Special rules"}
];

// Main App
const App = () => {
  const [nav, setNav] = useState("home");
  const [tab, setTab] = useState("overview");
  const [showSearch, setShowSearch] = useState(false);
  
  const [form, setForm] = useState({budgetClass:"01",companyCode:"1230",businessArea:"6601",jvCode:"",stage:"DEV",grossBudget:"",fundingStage:"AC",category:"Capital"});
  const [calc, setCalc] = useState(null);
  
  const [chat, setChat] = useState([{role:"ai",content:"üëã Hi! I'm your SAP Assistant.\n\nI can help with:\n‚Ä¢ Project creation & WBS\n‚Ä¢ Budget calculations\n‚Ä¢ Settlement rules\n‚Ä¢ Troubleshooting\n\nAsk anything!"}]);
  const [chatIn, setChatIn] = useState("");
  const chatEnd = useRef(null);
  
  useEffect(() => {
    const h = e => { if ((e.metaKey || e.ctrlKey) && e.key === 'k') { e.preventDefault(); setShowSearch(true); } if (e.key === 'Escape') setShowSearch(false); };
    window.addEventListener('keydown', h);
    return () => window.removeEventListener('keydown', h);
  }, []);
  
  useEffect(() => {
    if (!form.grossBudget) { setCalc(null); return; }
    const gross = parseFloat(form.grossBudget) || 0;
    const jvs = CONFIG.jvCodes[form.companyCode] || [];
    const jv = jvs.find(j => j.code === form.jvCode) || {em:100};
    const netAUD = Math.round(gross * jv.em / 100);
    const netUSD = Math.round(netAUD / CONFIG.exchangeRate.AUD_USD);
    let level = {level:4,desc:"L1-4 (Unlimited)"};
    if (netUSD <= 100000) level = {level:10,desc:"L10 ($100K)"};
    else if (netUSD <= 500000) level = {level:9,desc:"L9 ($500K)"};
    else if (netUSD <= 1e6) level = {level:8,desc:"L8 ($1M)"};
    else if (netUSD <= 5e6) level = {level:7,desc:"L7 ($5M)"};
    else if (netUSD <= 20e6) level = {level:6,desc:"L6 ($20M)"};
    else if (netUSD <= 50e6) level = {level:5,desc:"L5 ($50M)"};
    setCalc({...form, grossBudget:gross, emShare:jv.em, netBudgetAUD:netAUD, netBudgetUSD:netUSD, requiredLevel:{level:level.level,description:level.desc}, projectNumber:`6${form.budgetClass}/25001`});
  }, [form]);
  
  const sendChat = () => {
    if (!chatIn.trim()) return;
    setChat([...chat, {role:"user",content:chatIn}]);
    const q = chatIn.toLowerCase(); setChatIn("");
    setTimeout(() => {
      let r = "I'm not sure. Can you provide more details?";
      if (q.includes("project") && (q.includes("create") || q.includes("new"))) r = "To create a project:\n1. Complete prerequisites\n2. Open CJ20N\n3. Click 'Open Number'\n4. Enter company code\n5. Create WBS L1 & L2\n6. Save";
      else if (q.includes("budget")) r = "Budget entry:\n1. Open ZJ40\n2. Enter project\n3. Select funding stage\n4. Enter at WBS L1\n5. Verify FX rate\n6. Save";
      else if (q.includes("settlement")) r = "Settlement rules:\n‚Ä¢ Every WBS needs a rule for KO88\n‚Ä¢ Decommissioning: 490000030\n‚Ä¢ Capitalize: Asset number\n‚Ä¢ Set BEFORE TECO!";
      else if (q.includes("teco")) r = "TECO status:\n‚ö†Ô∏è For Decommissioning:\n1. Settlement rule FIRST\n2. Then set TECO\n\nCJ20N ‚Üí Edit ‚Üí Status ‚Üí Set TECO";
      setChat(c => [...c, {role:"ai",content:r}]);
    }, 500);
  };
  
  useEffect(() => { chatEnd.current?.scrollIntoView({behavior:"smooth"}); }, [chat]);
  
  const auditLog = [{ts:"2025-01-15T10:30:00Z",action:"Project Created",user:"john@co.com",type:"create"},{ts:"2025-01-15T10:35:00Z",action:"Prerequisites Verified",user:"john@co.com",type:"approval"},{ts:"2025-01-15T11:00:00Z",action:"Tax Review Submitted",user:"john@co.com",type:"approval"}];
  const compRules = [{name:"Budget Approval",passed:true},{name:"Prerequisites",passed:calc ? true : false},{name:"FCCR Attached",passed:false},{name:"Tax Review",passed:(calc?.netBudgetAUD||0) <= 3e6}];
  
  return (
    <div className="flex h-screen">
      <GlobalSearch isOpen={showSearch} onClose={() => setShowSearch(false)} data={SEARCH_DATA} />
      
      {/* Sidebar */}
      <div className="sidebar flex flex-col items-center py-4 gap-2">
        <div className="w-10 h-10 bg-white rounded-xl flex items-center justify-center font-bold text-blue-900 mb-4">PtA</div>
        {[{id:"home",icon:"Home"},{id:"workflows",icon:"GitBranch"},{id:"guides",icon:"BookOpen"},{id:"admin",icon:"Settings"}].map(i => (
          <div key={i.id} className={`sidebar-item ${nav === i.id ? 'active' : ''}`} onClick={() => setNav(i.id)}><Icon name={i.icon} size={22} /></div>
        ))}
        <div className="flex-1" />
        <div className="sidebar-item" onClick={() => setShowSearch(true)} title="Search ‚åòK"><Icon name="Search" size={22} /></div>
      </div>
      
      {/* Main */}
      <div className="flex-1 flex flex-col overflow-hidden">
        <header className="h-16 bg-white border-b flex items-center px-6 gap-4">
          <div><h1 className="font-semibold text-lg">PtA Migration Playbook</h1><p className="text-xs text-slate-500">Australia ‚Ä¢ Enhanced v2.4</p></div>
          <div className="flex-1" />
          <button onClick={() => setShowSearch(true)} className="flex items-center gap-2 px-4 py-2 bg-slate-100 rounded-lg text-sm text-slate-600 hover:bg-slate-200">
            <Icon name="Search" size={16} /><span>Search...</span><kbd className="text-xs bg-white px-1.5 py-0.5 rounded border ml-2">‚åòK</kbd>
          </button>
          <span className="text-sm font-medium ml-4">üá¶üá∫ Australia</span>
        </header>
        
        <div className="flex-1 flex overflow-hidden">
          <div className="flex-1 overflow-auto p-6">
            {/* Tabs */}
            <div className="flex gap-1 mb-6 border-b">
              {["overview","checklist","flowchart","compliance","export","history"].map(t => (
                <button key={t} className={`tab capitalize ${tab === t ? 'active' : ''}`} onClick={() => setTab(t)}>{t}</button>
              ))}
            </div>
            
            {/* Overview */}
            {tab === "overview" && (
              <div className="grid lg:grid-cols-3 gap-6">
                <div className="lg:col-span-2 space-y-6">
                  <div className="card">
                    <h3 className="font-semibold mb-4 flex items-center gap-2"><Icon name="FileText" size={18} className="text-blue-600" /> Project Details <Tooltip content="Enter details to auto-calculate prerequisites and approvals" /></h3>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div>
                        <label className="label">Budget Class <Tooltip content="01=Drilling, 02=Facilities, 03=EMIT, XF=Decommissioning" /></label>
                        <select className="input" value={form.budgetClass} onChange={e => setForm({...form, budgetClass:e.target.value, category:e.target.value==='XF'?'Decommissioning':'Capital'})}>
                          {CONFIG.budgetClasses.map(b => <option key={b.code} value={b.code}>{b.code} - {b.name}</option>)}
                        </select>
                      </div>
                      <div>
                        <label className="label">Company Code <Tooltip content="1230=Main, 0495=Secondary, 4310=OBO" /></label>
                        <select className="input" value={form.companyCode} onChange={e => setForm({...form, companyCode:e.target.value, businessArea:CONFIG.companyCodes.find(c=>c.code===e.target.value)?.ba||'6601', jvCode:''})}>
                          {CONFIG.companyCodes.map(c => <option key={c.code} value={c.code}>{c.code} - {c.name}</option>)}
                        </select>
                      </div>
                      <div>
                        <label className="label">JV Code <Tooltip content="Determines EM share for net calculation" /></label>
                        <select className="input" value={form.jvCode} onChange={e => setForm({...form, jvCode:e.target.value})}>
                          <option value="">Select JV...</option>
                          {(CONFIG.jvCodes[form.companyCode]||[]).map(j => <option key={j.code} value={j.code}>{j.code} - {j.name} ({j.em}%)</option>)}
                        </select>
                      </div>
                      <div>
                        <label className="label">Funding Stage <Tooltip content="AC/FF/SUP. SUP has stricter levels." /></label>
                        <select className="input" value={form.fundingStage} onChange={e => setForm({...form, fundingStage:e.target.value})}>
                          <option value="AC">AC - Advance Commitment</option>
                          <option value="FF">FF - Full Funding</option>
                          <option value="SUP">SUP - Supplement</option>
                        </select>
                      </div>
                      <div>
                        <label className="label">Project Stage</label>
                        <select className="input" value={form.stage} onChange={e => setForm({...form, stage:e.target.value})}>
                          {CONFIG.stages.map(s => <option key={s.code} value={s.code}>{s.code} - {s.name}</option>)}
                        </select>
                      </div>
                      <div>
                        <label className="label">Gross Budget (AUD) <Tooltip content="100% gross. Net calculated from EM share." /></label>
                        <input type="number" className="input" placeholder="e.g. 5000000" value={form.grossBudget} onChange={e => setForm({...form, grossBudget:e.target.value})} />
                      </div>
                    </div>
                    
                    {calc && (
                      <div className="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl">
                        <h4 className="font-semibold mb-3 flex items-center gap-2"><Icon name="Calculator" size={16} className="text-blue-600" /> Calculated</h4>
                        <div className="grid md:grid-cols-4 gap-4">
                          <div><span className="text-xs text-slate-500">Net (AUD)</span><p className="font-bold text-lg text-blue-700">${calc.netBudgetAUD.toLocaleString()}</p></div>
                          <div><span className="text-xs text-slate-500">Net (USD)</span><p className="font-bold text-lg text-blue-700">${calc.netBudgetUSD.toLocaleString()}</p></div>
                          <div><span className="text-xs text-slate-500">EM Share</span><p className="font-bold text-lg">{calc.emShare}%</p></div>
                          <div><span className="text-xs text-slate-500">Approval</span><p className="font-bold text-lg text-green-700">{calc.requiredLevel.description}</p></div>
                        </div>
                        <div className="mt-4 flex flex-wrap gap-2">
                          {calc.netBudgetAUD > 3e6 && <span className="badge badge-red">‚ö†Ô∏è Tax Review</span>}
                          {calc.netBudgetAUD > 5e6 && <span className="badge badge-amber">‚ö†Ô∏è JV Approval</span>}
                          {calc.budgetClass === "03" && <span className="badge badge-purple">üìã Fund.IT</span>}
                          {calc.budgetClass === "XF" && <span className="badge badge-red">‚ö†Ô∏è Settlement Critical</span>}
                        </div>
                      </div>
                    )}
                  </div>
                  
                  {calc && <AIInsights project={calc} />}
                </div>
                
                <div className="space-y-6">
                  <div className="card">
                    <h4 className="font-semibold mb-3">Quick Reference</h4>
                    <div className="space-y-3">
                      <div className="flex justify-between items-center"><span className="text-sm text-slate-600">Exchange</span><span className="value-pill">1 AUD = {(1/CONFIG.exchangeRate.AUD_USD).toFixed(4)} USD</span></div>
                      <div className="flex justify-between items-center"><span className="text-sm text-slate-600">Tax Threshold</span><span className="value-pill">$3M AUD</span></div>
                      <div className="flex justify-between items-center"><span className="text-sm text-slate-600">JV Threshold</span><span className="value-pill">$5M AUD</span></div>
                      <div className="flex justify-between items-center"><span className="text-sm text-slate-600">Next FX Update</span><span className="text-sm text-slate-500">{CONFIG.exchangeRate.nextUpdate}</span></div>
                    </div>
                  </div>
                  <div className="card">
                    <div className="flex items-center justify-between mb-2"><span className="text-sm font-medium">Version</span><span className="badge badge-green">v2.4.0</span></div>
                    <p className="text-xs text-slate-500">Updated: Jan 15, 2025</p>
                    <button onClick={() => setTab('history')} className="text-xs text-blue-600 hover:underline mt-2">View history ‚Üí</button>
                  </div>
                </div>
              </div>
            )}
            
            {/* Checklist */}
            {tab === "checklist" && (
              <div className="max-w-3xl">
                <div className="card">
                  {calc ? (
                    <>
                      <SmartChecklist items={CHECKLIST_ITEMS} projectData={calc} />
                      <FeedbackSystem onSubmit={f => console.log('Feedback:', f)} />
                    </>
                  ) : (
                    <div className="text-center py-12 text-slate-400">
                      <Icon name="ClipboardList" size={48} className="mx-auto mb-4 opacity-50" />
                      <h3 className="font-medium text-lg mb-2">No Project Data</h3>
                      <p className="text-sm">Enter details in Overview to generate checklist</p>
                      <button onClick={() => setTab('overview')} className="btn btn-primary mt-4">Go to Overview</button>
                    </div>
                  )}
                </div>
              </div>
            )}
            
            {/* Flowchart */}
            {tab === "flowchart" && (
              <div className="space-y-6">
                <div className="card">
                  <InteractiveFlowchart nodes={FLOW_NODES} activeStep={calc?.budgetClass === '03' ? 'prereq' : 'fccr'} onNodeClick={n => console.log('Node:', n)} />
                </div>
                <div className="card">
                  <h4 className="font-semibold mb-4 flex items-center gap-2"><Icon name="GitMerge" size={18} className="text-amber-600" /> Decision Tree</h4>
                  <div className="space-y-4">
                    <div className="p-4 bg-slate-50 rounded-lg">
                      <div className="flex items-center gap-3 mb-3"><span className="w-8 h-8 rounded-full bg-amber-100 text-amber-700 flex items-center justify-center font-bold">1</span><span className="font-medium">Budget Class?</span></div>
                      <div className="ml-11 grid grid-cols-4 gap-2">
                        {CONFIG.budgetClasses.map(b => <div key={b.code} className={`p-3 rounded-lg border ${calc?.budgetClass === b.code ? 'border-blue-500 bg-blue-50' : 'border-slate-200'}`}><span className="font-mono text-sm">{b.code}</span><p className="text-xs text-slate-600">{b.name}</p></div>)}
                      </div>
                    </div>
                    <div className="p-4 bg-slate-50 rounded-lg">
                      <div className="flex items-center gap-3 mb-3"><span className="w-8 h-8 rounded-full bg-amber-100 text-amber-700 flex items-center justify-center font-bold">2</span><span className="font-medium">Net Budget (AUD)?</span></div>
                      <div className="ml-11 space-y-2">
                        <div className={`p-2 rounded border ${(calc?.netBudgetAUD||0) <= 3e6 ? 'border-green-500 bg-green-50' : 'border-slate-200'}`}>‚â§ $3M ‚Üí No Tax Review</div>
                        <div className={`p-2 rounded border ${(calc?.netBudgetAUD||0) > 3e6 && (calc?.netBudgetAUD||0) <= 5e6 ? 'border-amber-500 bg-amber-50' : 'border-slate-200'}`}>&gt; $3M ‚Üí Tax Review</div>
                        <div className={`p-2 rounded border ${(calc?.netBudgetAUD||0) > 5e6 ? 'border-red-500 bg-red-50' : 'border-slate-200'}`}>&gt; $5M ‚Üí Tax + JV</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )}
            
            {/* Compliance */}
            {tab === "compliance" && (
              <div className="grid lg:grid-cols-2 gap-6">
                <ComplianceAudit score={compRules.filter(r=>r.passed).length/compRules.length*100|0} rules={compRules} auditLog={auditLog} />
                <div className="card">
                  <h3 className="font-semibold mb-4 flex items-center gap-2"><Icon name="ClipboardCheck" size={18} className="text-green-600" /> Compliance Checklist</h3>
                  <div className="space-y-3">
                    {[{n:"FCCR Approval",s:"pending",c:true},{n:"Budget Form",s:"done"},{n:"Prerequisites",s:"pending"},{n:"Signatures",s:"pending"},{n:"Settlement Rule",s:calc?.budgetClass==='XF'?"pending":"na"}].map((i,x) => (
                      <div key={x} className="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                        <div className="flex items-center gap-2"><Icon name={i.s==='done'?'CheckCircle':i.s==='na'?'MinusCircle':'Circle'} size={18} className={i.s==='done'?'text-green-600':i.s==='na'?'text-slate-400':'text-slate-400'} /><span className={i.s==='na'?'text-slate-400':''}>{i.n}</span>{i.c && <span className="badge badge-red">Critical</span>}</div>
                        {i.s !== 'na' && i.s !== 'done' && <button className="btn btn-sm btn-primary">Complete</button>}
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}
            
            {/* Export */}
            {tab === "export" && (
              <div className="grid lg:grid-cols-2 gap-6">
                <ExportManager data={{checklist:CHECKLIST_ITEMS,auditLog}} project={calc} onExport={r => console.log('Export:', r)} />
                <div className="card">
                  <h3 className="font-semibold mb-4 flex items-center gap-2"><Icon name="FileBarChart" size={18} className="text-purple-600" /> Recent Exports</h3>
                  <div className="space-y-3">
                    {[{n:"Project Report",f:"PDF",d:"Jan 15",s:"245 KB"},{n:"Compliance Summary",f:"CSV",d:"Jan 10",s:"1.2 MB"},{n:"Audit Export",f:"JSON",d:"Jan 5",s:"89 KB"}].map((e,i) => (
                      <div key={i} className="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                        <div className="flex items-center gap-3"><Icon name={e.f==='PDF'?'FileText':e.f==='CSV'?'Table':'Code'} size={20} className="text-slate-400" /><div><p className="font-medium text-sm">{e.n}</p><p className="text-xs text-slate-500">{e.d} ‚Ä¢ {e.s}</p></div></div>
                        <button className="btn btn-secondary btn-sm"><Icon name="Download" size={14} /></button>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}
            
            {/* History */}
            {tab === "history" && (
              <div className="max-w-2xl">
                <VersionHistory versions={VERSIONS} current="2.4.0" onRestore={v => confirm(`Restore to v${v.version}?`) && alert(`Restored to v${v.version}`)} />
              </div>
            )}
          </div>
          
          {/* Chat Panel */}
          <div className="advisor-panel">
            <div className="p-4 border-b bg-gradient-to-r from-blue-50 to-indigo-50">
              <h3 className="font-semibold flex items-center gap-2"><Icon name="MessageSquare" size={18} className="text-blue-600" /> AI Assistant</h3>
              <p className="text-xs text-slate-500 mt-1">Ask about SAP processes</p>
            </div>
            <div className="flex-1 overflow-auto p-4 space-y-3">
              {chat.map((m, i) => <div key={i} className={`chat-bubble ${m.role === "user" ? "chat-user" : "chat-ai"}`} style={{whiteSpace:"pre-wrap"}}>{m.content}</div>)}
              <div ref={chatEnd} />
            </div>
            <div className="p-4 border-t flex gap-2">
              <input className="input flex-1" placeholder="Ask anything..." value={chatIn} onChange={e => setChatIn(e.target.value)} onKeyDown={e => e.key === "Enter" && sendChat()} />
              <button onClick={sendChat} className="btn btn-primary px-3"><Icon name="Send" size={18} /></button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
